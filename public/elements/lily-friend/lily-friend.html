<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">

<link rel="import" href="../lily-editor/lily-editor.html">
<link rel="import" href="../lily-preview/lily-preview.html">
<polymer-element name="lily-friend">

    <template>
        <style>
            .half {
                padding: 1em;
                width: 50%;
            }
            .container{
                overflow-y: auto;
            }
            paper-fab {
                background-color: #03a9f4;
            }
        </style>
        <div horizontal layout fit>
            <div class="half" vertical layout>
                <div horizontal layout end-justified>
                    <paper-fab mini icon="send" on-tap="{{send}}" disabled?="{{converting}}"></paper-fab>
                </div>
                <div flex class="container">
                    <lily-editor source="{{source}}" flex></lily-editor>
                </div>
            </div>
            <div class="half" vertical layout>
                <div horizontal layout end-justified>
                    <paper-fab mini icon="send" on-tap="{{send}}" disabled?="{{converting}}"></paper-fab>
                </div>
                <div flex class="container">
                    <lily-preview source="{{rendered}}" converting="{{converting}}" error="{{error}}"></lily-preview>
                </div>
            </div>
        </div>
        <core-ajax id="convertAjax"
                method="POST"
                url="/convert"
                handleAs="text"
                body="{{source}}"
                on-core-response="{{responsed}}"
                on-core-error="{{errored}}"></core-ajax>
    </template>
    <script>
        Polymer({
            send: function(){
                this.$.convertAjax.go();
                this.converting = true;
            },
            responsed: function(event, detail, target){
                this.rendered = detail.response;
                this.error = undefined;
                this.converting = false;
            },
            errored: function(event, detail, target) {
                this.error = detail.xhr.responseText;
                this.converting = false;
            }
        });
    </script>
</polymer-element>


